<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FitTakip Pro - Hedef Odaklƒ±</title>
    <style>
        /* GENEL AYARLAR */
        :root { --primary: #007bff; --warning: #ffc107; --danger: #dc3545; --success: #28a745; --bg: #f4f7f6; --text: #333; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: var(--text); overflow-x: hidden; }
        
        /* HEADER */
        header { background: white; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; align-items: center; position: sticky; top: 0; z-index: 100; }
        .menu-btn { font-size: 24px; cursor: pointer; margin-right: 15px; background: none; border: none; color: var(--primary); }
        .app-title { font-size: 18px; font-weight: bold; margin: 0; }
        .date-badge { margin-left: auto; font-size: 12px; color: #888; background: #eee; padding: 4px 8px; border-radius: 12px; }

        /* SIDEBAR */
        .sidebar { height: 100%; width: 250px; position: fixed; z-index: 200; top: 0; left: -260px; background-color: #343a40; transition: 0.3s; padding-top: 60px; }
        .sidebar a { padding: 15px 25px; text-decoration: none; font-size: 16px; color: #f1f1f1; display: block; border-bottom: 1px solid #444; }
        .sidebar a:hover { background-color: var(--primary); }
        .closebtn { position: absolute; top: 10px; right: 20px; font-size: 36px; color: white; background: none; border: none; cursor: pointer; }
        .overlay { display: none; position: fixed; width: 100%; height: 100%; top: 0; left: 0; background-color: rgba(0,0,0,0.5); z-index: 150; }

        /* SAYFALAR & KARTLAR */
        .page { display: none; padding: 20px; max-width: 600px; margin: 0 auto; animation: fadeIn 0.4s; }
        .page.active { display: block; }
        .card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        h2 { margin-top: 0; font-size: 18px; color: var(--primary); border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }

        /* FORM */
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        button.primary-btn { width: 100%; background-color: var(--primary); color: white; padding: 14px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        
        /* √ñZEL TASARIMLAR (BMI & Hedef) */
        .weight-alert { background-color: #ffecec; border: 1px solid var(--danger); color: var(--danger); padding: 10px; border-radius: 8px; margin-bottom: 15px; display: none; text-align: center; font-weight: bold; cursor: pointer; }
        
        .bmi-box { display: flex; justify-content: space-between; align-items: center; background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .bmi-value { font-size: 24px; font-weight: bold; color: var(--primary); }
        .bmi-label { font-size: 12px; background: #eee; padding: 3px 8px; border-radius: 4px; }
        
        .progress-container { margin-top: 10px; }
        .progress-bar { height: 10px; background-color: #e9ecef; border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; background-color: var(--success); width: 0%; transition: width 0.5s; }
        .goal-text { font-size: 12px; color: #666; display: flex; justify-content: space-between; margin-top: 5px; }

        /* Lƒ∞STE */
        .task-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #f0f0f0; }
        .task-checkbox { width: 24px; height: 24px; margin-right: 15px; }
        .task-content { flex-grow: 1; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="overlay" class="overlay" onclick="closeNav()"></div>

    <div id="mySidebar" class="sidebar">
        <button class="closebtn" onclick="closeNav()">&times;</button>
        <div style="text-align:center; padding: 20px; color: #888; font-size: 12px;">MEN√ú</div>
        <a href="#" onclick="switchPage('dashboard')">üè† Ana Sayfa</a>
        <a href="#" onclick="switchPage('add-activity')">‚ûï Aktivite Ekle</a>
        <a href="#" onclick="switchPage('history')">üìú Ge√ßmi≈ü</a>
        <a href="#" onclick="switchPage('profile')">üë§ Profil & Hedefler</a>
    </div>

    <header>
        <button class="menu-btn" onclick="openNav()">&#9776;</button>
        <p class="app-title">FitTakip Pro</p>
        <span class="date-badge" id="headerDate">--.--.----</span>
    </header>

    <div id="dashboard" class="page active">
        
        <div id="weightReminder" class="weight-alert" onclick="switchPage('profile')">
            ‚ö†Ô∏è Tartƒ±lma zamanƒ± geldi! G√ºncel kilonu girmek i√ßin tƒ±kla.
        </div>

        <div class="card">
            <h2>V√ºcut Durumu</h2>
            
            <div class="bmi-box">
                <div>
                    <div style="font-size:12px; color:#888;">BMI ƒ∞ndeksi</div>
                    <div class="bmi-value" id="bmiValue">--</div>
                </div>
                <div class="bmi-label" id="bmiLabel">Veri Yok</div>
            </div>

            <div class="progress-container">
                <div class="goal-text">
                    <span>Mevcut: <strong id="currentWeightDisplay">--</strong> kg</span>
                    <span>Hedef: <strong id="targetWeightDisplay">--</strong> kg</span>
                </div>
                <div class="progress-bar">
                    <div id="weightProgress" class="progress-fill"></div>
                </div>
                <small style="font-size:10px; color:#999; margin-top:5px; display:block;">Hedefe kalan: <span id="weightDiff">--</span> kg</small>
            </div>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-around; text-align: center;">
                <div><strong id="totalCalDisp" style="color:var(--primary); font-size:20px;">0</strong><br><span style="font-size:12px;">Toplam</span></div>
                <div><strong id="stepCalDisp" style="color:#666; font-size:20px;">0</strong><br><span style="font-size:12px;">Adƒ±m</span></div>
                <div><strong id="sportCalDisp" style="color:#666; font-size:20px;">0</strong><br><span style="font-size:12px;">Spor</span></div>
            </div>
        </div>

        <div class="card">
            <h2>G√ºn√ºn Antrenmanlarƒ±</h2>
            <div id="taskListContainer"></div>
        </div>

        <div class="card">
            <h2>Adƒ±m Sayacƒ±</h2>
            <input type="number" id="dailyStepsInput" placeholder="Bug√ºnk√º adƒ±m..." oninput="calculate()">
        </div>
    </div>

    <div id="add-activity" class="page">
        <div class="card">
            <h2>Yeni Aktivite Tanƒ±mla</h2>
            <label>Aktivite Adƒ±</label><input type="text" id="newActName">
            <label>YouTube Linki</label><input type="url" id="newActLink">
            <label>Kalori</label><input type="number" id="newActCal">
            <button class="primary-btn" onclick="addNewActivity()">Ekle</button>
        </div>
        <div class="card">
            <h2>Listem</h2>
            <div id="manageListContainer"></div>
        </div>
    </div>

    <div id="history" class="page">
        <div class="card">
            <h2>Ge√ßmi≈ü G√ºnl√ºkler</h2>
            <table style="width:100%; font-size:14px; text-align:left;" id="historyTable">
                <thead><tr><th>Tarih</th><th>Adƒ±m</th><th>Kcal</th></tr></thead>
                <tbody></tbody>
            </table>
            <button class="primary-btn" style="background:#6c757d;" onclick="clearHistory()">Temizle</button>
        </div>
    </div>

    <div id="profile" class="page">
        <div class="card">
            <h2>V√ºcut Bilgileri</h2>
            
            <label>Boy (cm)</label>
            <input type="number" id="userHeight" placeholder="180" onchange="calculate()">

            <label>G√ºncel Kilo (kg)</label>
            <input type="number" id="userWeight" placeholder="80" onchange="updateWeightDate()">

            <label>Hedef Kilo (kg)</label>
            <input type="number" id="targetWeight" placeholder="70" onchange="saveData()">

            <label>Kilo Takip Sƒ±klƒ±ƒüƒ±</label>
            <select id="weightFreq" onchange="saveData()">
                <option value="7">Haftada Bir (7 G√ºn)</option>
                <option value="30">Ayda Bir (30 G√ºn)</option>
            </select>
            
            <button class="primary-btn" onclick="saveData(); alert('Profil Kaydedildi!'); updateUI();">Bilgileri Kaydet</button>
        </div>

        <div class="card">
            <h2>G√ºn√º Bitir</h2>
            <button class="primary-btn" style="background:#ff9800;" onclick="forceEndDay()">G√ºn√º Ar≈üivle ve Bitir</button>
        </div>
    </div>

<script>
    // --- VERƒ∞ YAPISI ---
    let appData = {
        activities: [], 
        history: [],
        weight: 0,
        height: 0,
        targetWeight: 0,
        weightFreq: 7, // 7 g√ºn veya 30 g√ºn
        lastWeightUpdate: null, // "2023-10-27" formatƒ±nda string
        dailySteps: 0,
        lastDate: new Date().toLocaleDateString('tr-TR')
    };

    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        checkNewDay();
        updateUI();
        document.getElementById('headerDate').innerText = appData.lastDate;
    });

    // --- MEN√ú ---
    function openNav() { document.getElementById("mySidebar").style.left = "0"; document.getElementById("overlay").style.display = "block"; }
    function closeNav() { document.getElementById("mySidebar").style.left = "-260px"; document.getElementById("overlay").style.display = "none"; }
    function switchPage(pageId) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        closeNav();
        updateUI();
    }

    // --- TEMEL ƒ∞≈ûLEVLER ---
    function updateWeightDate() {
        // Kullanƒ±cƒ± kiloyu deƒüi≈ütirdiƒüinde, son g√ºncelleme tarihini BUG√úN yap
        appData.lastWeightUpdate = new Date().toISOString().split('T')[0];
        calculate();
    }

    function calculate() {
        // Formdan verileri al
        appData.weight = parseFloat(document.getElementById('userWeight').value) || 0;
        appData.height = parseFloat(document.getElementById('userHeight').value) || 0;
        appData.targetWeight = parseFloat(document.getElementById('targetWeight').value) || 0;
        appData.weightFreq = parseInt(document.getElementById('weightFreq').value) || 7;
        appData.dailySteps = parseInt(document.getElementById('dailyStepsInput').value) || 0;

        // Kalori Hesapla
        const stepCals = Math.round(appData.dailySteps * 0.0005 * appData.weight);
        let sportCals = 0;
        appData.activities.forEach(a => { if(a.completed) sportCals += a.cal; });
        const total = stepCals + sportCals;

        // Ekrana Kalori Yaz
        document.getElementById('totalCalDisp').innerText = total;
        document.getElementById('stepCalDisp').innerText = stepCals;
        document.getElementById('sportCalDisp').innerText = sportCals;

        // BMI ve Hedef Hesapla
        calculateBMI();
        checkWeightReminder();
        saveData();
    }

    function calculateBMI() {
        // BMI = kg / (m * m)
        if(appData.weight > 0 && appData.height > 0) {
            const heightInMeters = appData.height / 100;
            const bmi = (appData.weight / (heightInMeters * heightInMeters)).toFixed(1);
            
            let label = "";
            let color = "gray";

            if(bmi < 18.5) { label = "Zayƒ±f"; color = "#17a2b8"; }
            else if(bmi < 25) { label = "Normal"; color = "#28a745"; }
            else if(bmi < 30) { label = "Fazla Kilolu"; color = "#ffc107"; }
            else { label = "Obez"; color = "#dc3545"; }

            document.getElementById('bmiValue').innerText = bmi;
            document.getElementById('bmiLabel').innerText = label;
            document.getElementById('bmiLabel').style.backgroundColor = color;
            document.getElementById('bmiLabel').style.color = "white";
        }

        // Hedef Kilo Barƒ±
        document.getElementById('currentWeightDisplay').innerText = appData.weight;
        document.getElementById('targetWeightDisplay').innerText = appData.targetWeight;

        if(appData.weight > 0 && appData.targetWeight > 0) {
            const diff = (appData.weight - appData.targetWeight).toFixed(1);
            document.getElementById('weightDiff').innerText = Math.abs(diff);

            // Basit bir g√∂rselle≈ütirme: Kilo vermeye √ßalƒ±≈üƒ±yorsa
            if(appData.weight > appData.targetWeight) {
                // Hedefe ne kadar yakla≈ütƒ±k? (Farazi bir ba≈ülangƒ±√ß noktasƒ± olmadan tam y√ºzde veremeyiz ama g√∂rsel bir doluluk yapabiliriz)
                // ≈ûimdilik sadece hedef ile mevcut arasƒ±ndaki farkƒ± g√∂stermeyelim, dolu g√∂sterelim.
                document.getElementById('weightProgress').style.width = "100%"; 
                document.getElementById('weightProgress').style.backgroundColor = "#007bff";
            } else {
                // Kilo almaya √ßalƒ±≈üƒ±yorsa veya hedefteyse
                document.getElementById('weightProgress').style.width = "100%";
                document.getElementById('weightProgress').style.backgroundColor = "#28a745";
            }
        }
    }

    function checkWeightReminder() {
        if(!appData.lastWeightUpdate) return; // Hen√ºz hi√ß girilmemi≈ü

        const lastDate = new Date(appData.lastWeightUpdate);
        const today = new Date();
        const diffTime = Math.abs(today - lastDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

        // Eƒüer ge√ßen g√ºn sayƒ±sƒ± se√ßilen frekansdan fazlaysa uyarƒ± g√∂ster
        const alertBox = document.getElementById('weightReminder');
        if(diffDays > appData.weightFreq) {
            alertBox.style.display = 'block';
            alertBox.innerHTML = `‚ö†Ô∏è <strong>${diffDays} g√ºnd√ºr</strong> tartƒ±lmadƒ±n! G√ºncellemek i√ßin tƒ±kla.`;
        } else {
            alertBox.style.display = 'none';
        }
    }

    // --- Sƒ∞STEM ---
    function addNewActivity() {
        const name = document.getElementById('newActName').value;
        const link = document.getElementById('newActLink').value;
        const cal = parseInt(document.getElementById('newActCal').value);
        if(!name || !cal) { alert("Eksik bilgi!"); return; }
        appData.activities.push({ id: Date.now(), name, link, cal, completed: false });
        saveData(); updateUI();
        document.getElementById('newActName').value = ''; document.getElementById('newActLink').value = ''; document.getElementById('newActCal').value = '';
        alert("Eklendi!");
    }

    function toggleTask(id) {
        const t = appData.activities.find(a => a.id === id);
        if(t) { t.completed = !t.completed; saveData(); calculate(); renderTaskList(); }
    }
    
    function deleteTask(id) {
        if(confirm("Silinsin mi?")) { appData.activities = appData.activities.filter(a => a.id !== id); saveData(); updateUI(); }
    }

    function renderTaskList() {
        const c = document.getElementById('taskListContainer'); c.innerHTML = '';
        appData.activities.forEach(a => {
            c.innerHTML += `
            <div class="task-item">
                <input type="checkbox" class="task-checkbox" ${a.completed ? 'checked' : ''} onchange="toggleTask(${a.id})">
                <div class="task-content">
                    <div style="${a.completed ? 'text-decoration:line-through;color:#aaa' : 'font-weight:600'}">${a.name}</div>
                    <small>${a.cal} kcal</small> ${a.link ? `<a href="${a.link}" target="_blank" style="color:#007bff;margin-left:5px;">‚ñ∂ ƒ∞zle</a>` : ''}
                </div>
            </div>`;
        });
    }

    function renderManageList() {
        const c = document.getElementById('manageListContainer'); c.innerHTML = '';
        appData.activities.forEach(a => c.innerHTML += `<div class="task-item"><div><strong>${a.name}</strong> (${a.cal} kcal)</div><button style="background:#dc3545;color:white;border:none;padding:5px;" onclick="deleteTask(${a.id})">Sil</button></div>`);
    }

    function updateUI() {
        document.getElementById('userWeight').value = appData.weight || '';
        document.getElementById('userHeight').value = appData.height || '';
        document.getElementById('targetWeight').value = appData.targetWeight || '';
        document.getElementById('weightFreq').value = appData.weightFreq || 7;
        document.getElementById('dailyStepsInput').value = appData.dailySteps || '';
        
        renderTaskList(); renderManageList(); 
        const tb = document.querySelector('#historyTable tbody'); tb.innerHTML = '';
        appData.history.forEach(h => tb.innerHTML += `<tr><td>${h.date}</td><td>${h.steps}</td><td>${h.total} kcal</td></tr>`);
        
        calculate(); // BMI ve Kalori hesaplarƒ±nƒ± tetikle
    }

    function checkNewDay() {
        const today = new Date().toLocaleDateString('tr-TR');
        if(appData.lastDate !== today) {
            archiveDay(appData.lastDate);
            appData.lastDate = today;
            appData.dailySteps = 0;
            appData.activities.forEach(a => a.completed = false);
            saveData();
            alert("Yeni g√ºn ba≈üladƒ±! Bol ≈üans.");
        }
    }

    function forceEndDay() {
        if(confirm("G√ºn√º bitir?")) { archiveDay(appData.lastDate + " (Manuel)"); appData.dailySteps=0; appData.activities.forEach(a=>a.completed=false); saveData(); updateUI(); }
    }

    function archiveDay(d) {
        const s = Math.round(appData.dailySteps * 0.0005 * appData.weight);
        let sp = 0; appData.activities.forEach(a => { if(a.completed) sp += a.cal; });
        if(s+sp > 0) appData.history.unshift({ date: d, steps: appData.dailySteps, total: s+sp });
    }
    
    function clearHistory() { if(confirm("Ge√ßmi≈ü silinsin mi?")) { appData.history=[]; saveData(); updateUI(); } }

    function saveData() { localStorage.setItem('fitProData_v3', JSON.stringify(appData)); }
    function loadData() { const d = localStorage.getItem('fitProData_v3'); if(d) appData = JSON.parse(d); }
</script>

</body>
</html>
