<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spor & Kalori Takip (GeÃ§miÅŸ Ã–zellikli)</title>
    <style>
        /* TASARIM KISMI (CSS) */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1, h2, h3 { text-align: center; color: #333; }
        .section { margin-bottom: 30px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 8px; position: relative; }
        
        /* Form ElemanlarÄ± */
        label { display: block; margin-top: 10px; font-weight: bold; color: #555; }
        input[type="text"], input[type="number"], input[type="url"] { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { background-color: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px; width: 100%; font-size: 16px; transition: 0.3s; }
        button:hover { background-color: #218838; }
        button.delete-btn { background-color: #dc3545; width: auto; padding: 5px 10px; font-size: 12px; margin-left: 10px; }
        
        /* Manuel GÃ¼nÃ¼ Bitir Butonu (Opsiyonel) */
        .manual-save-btn { background-color: #007bff; margin-top: 20px; }
        .manual-save-btn:hover { background-color: #0056b3; }

        /* Aktivite Listesi */
        .activity-item { display: flex; align-items: center; justify-content: space-between; background: #f9f9f9; padding: 10px; margin-top: 10px; border-radius: 5px; border-left: 5px solid #007bff; }
        .activity-info { flex-grow: 1; margin-left: 10px; }
        .activity-link { color: #007bff; text-decoration: none; font-size: 14px; margin-right: 10px; }
        
        /* Kalori Ã–zeti KartÄ± */
        .summary-box { background-color: #343a40; color: white; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px; }
        .big-number { font-size: 3em; font-weight: bold; color: #ffc107; }
        
        /* Checkbox TasarÄ±mÄ± */
        input[type="checkbox"] { transform: scale(1.5); cursor: pointer; }

        /* GEÃ‡MÄ°Åž TABLOSU */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; color: #333; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .date-badge { background: #6c757d; color: white; padding: 3px 8px; border-radius: 10px; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸ“… GeliÅŸmiÅŸ Spor TakipÃ§isi</h1>
    <p style="text-align:center; color:gray;">BugÃ¼n: <span id="displayDate" style="font-weight:bold; color:black;"></span></p>

    <div class="summary-box">
        <h3>BugÃ¼nkÃ¼ Toplam YakÄ±m</h3>
        <div class="big-number"><span id="totalCalories">0</span> kcal</div>
        <p>AdÄ±m: <span id="stepCalories">0</span> + Spor: <span id="sportCalories">0</span></p>
    </div>

    <div class="section">
        <h2>BugÃ¼nÃ¼n GÃ¶revleri</h2>
        <div id="activityList">
            </div>
        
        <hr>
        
        <label>BugÃ¼n AtÄ±lan AdÄ±m SayÄ±sÄ±:</label>
        <input type="number" id="dailySteps" placeholder="0" oninput="calculateTotal()">
        
        <button class="manual-save-btn" onclick="forceEndDay()">âœ… GÃ¼nÃ¼ Manuel Bitir ve Kaydet</button>
        <small style="display:block; text-align:center; margin-top:5px; color:gray;">(Otomatik olarak gece 00:00'dan sonra zaten kaydeder. Ä°stersen buna basarak gÃ¼nÃ¼ ÅŸimdiden kapatabilirsin.)</small>
    </div>

    <div class="section">
        <h2>Ayarlar ve Aktivite Ekleme</h2>
        <div style="display: flex; gap: 10px;">
            <div style="flex:1;">
                <label>Kilo (kg):</label>
                <input type="number" id="userWeight" placeholder="80" onchange="calculateTotal()">
            </div>
            <div style="flex:2;">
                <label>Yeni Aktivite AdÄ±:</label>
                <input type="text" id="newActName" placeholder="Ã–rn: Mekik">
            </div>
            <div style="flex:1;">
                <label>Kalori:</label>
                <input type="number" id="newActCals" placeholder="100">
            </div>
        </div>
        <input type="url" id="newActLink" placeholder="Varsa YouTube Linki..." style="margin-top:5px;">
        <button onclick="addActivity()" style="background-color:#6c757d;">Listeye Yeni Spor Ekle</button>
    </div>

    <div class="section">
        <h2>ðŸ“œ GeÃ§miÅŸ GÃ¼nlÃ¼kler</h2>
        <table id="historyTable">
            <thead>
                <tr>
                    <th>Tarih</th>
                    <th>AdÄ±m</th>
                    <th>Toplam Kalori</th>
                    <th>Durum</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        <button onclick="clearHistory()" class="delete-btn" style="width:100%; margin-top:10px;">GeÃ§miÅŸi Temizle</button>
    </div>
</div>

<script>
    /* MANTIK KISMI 
       Bu kod, sayfa her aÃ§Ä±ldÄ±ÄŸÄ±nda tarihe bakar. 
       EÄŸer tarih deÄŸiÅŸmiÅŸse, eski veriyi tabloya atar ve ekranÄ± sÄ±fÄ±rlar.
    */

    let activities = [];
    let historyLog = [];
    let currentDate = new Date().toLocaleDateString('tr-TR');

    document.getElementById('displayDate').innerText = currentDate;

    // Uygulama BaÅŸlangÄ±cÄ±
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        checkNewDay(); // Ã–NEMLÄ°: Yeni gÃ¼n kontrolÃ¼ yap
        renderActivities();
        calculateTotal();
        renderHistory();
    });

    // 1. Yeni GÃ¼n KontrolÃ¼ (00:00 MantÄ±ÄŸÄ±)
    function checkNewDay() {
        const lastSavedDate = localStorage.getItem('last_active_date');

        // EÄŸer daha Ã¶nce kaydedilmiÅŸ bir tarih varsa VE bugÃ¼n o tarih deÄŸilse
        if (lastSavedDate && lastSavedDate !== currentDate) {
            alert("Yeni bir gÃ¼n! DÃ¼nkÃ¼ verilerin geÃ§miÅŸe kaydedildi ve liste sÄ±fÄ±rlandÄ±. â˜€ï¸");
            archiveDay(lastSavedDate); // Eski gÃ¼nÃ¼ arÅŸive at
        }
        
        // BugÃ¼nÃ¼n tarihini kaydet (ki sonraki giriÅŸte kontrol edebilelim)
        localStorage.setItem('last_active_date', currentDate);
    }

    // 2. GÃ¼nÃ¼ ArÅŸivleme Fonksiyonu
    function archiveDay(dateLabel) {
        // Åžu anki toplamlarÄ± hesapla (hafÄ±zadaki veriden)
        let totalCals = parseInt(document.getElementById('totalCalories').innerText) || 0;
        let steps = parseInt(document.getElementById('dailySteps').value) || 0;

        // GeÃ§miÅŸ dizisine ekle
        const log = {
            date: dateLabel,
            steps: steps,
            calories: totalCals,
            note: "TamamlandÄ±"
        };
        
        historyLog.unshift(log); // En baÅŸa ekle (yeni tarih Ã¼stte olsun)
        
        // EKRANI SIFIRLA
        document.getElementById('dailySteps').value = ''; 
        activities.forEach(act => act.completed = false); // TÃ¼m tikleri kaldÄ±r
        
        saveData();
        renderHistory();
        renderActivities();
        calculateTotal();
    }

    // 3. Manuel Olarak GÃ¼nÃ¼ Bitirme
    function forceEndDay() {
        if(confirm("GÃ¼nÃ¼ bitirmek istediÄŸine emin misin? Mevcut skorun geÃ§miÅŸe kaydedilecek ve sayaÃ§lar sÄ±fÄ±rlanacak.")) {
            archiveDay(currentDate + " (Manuel)");
        }
    }

    // 4. GeÃ§miÅŸi Ekrana YazdÄ±rma
    function renderHistory() {
        const tbody = document.querySelector('#historyTable tbody');
        tbody.innerHTML = '';

        if(historyLog.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4">HenÃ¼z geÃ§miÅŸ kayÄ±t yok.</td></tr>';
            return;
        }

        historyLog.forEach(log => {
            const row = `
                <tr>
                    <td><span class="date-badge">${log.date}</span></td>
                    <td>${log.steps}</td>
                    <td style="font-weight:bold; color:#28a745;">${log.calories} kcal</td>
                    <td>âœ…</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    // --- ESKÄ° TEMEL FONKSÄ°YONLAR (Aynen Korundu) ---

    function addActivity() {
        const name = document.getElementById('newActName').value;
        const link = document.getElementById('newActLink').value;
        const cals = parseInt(document.getElementById('newActCals').value);

        if (!name || !cals) return alert("Ä°sim ve kalori gerekli!");

        activities.push({ id: Date.now(), name, link, cals, completed: false });
        saveData(); renderActivities();
        
        document.getElementById('newActName').value = '';
        document.getElementById('newActLink').value = '';
        document.getElementById('newActCals').value = '';
    }

    function renderActivities() {
        const list = document.getElementById('activityList');
        list.innerHTML = '';
        activities.forEach(act => {
            list.innerHTML += `
                <div class="activity-item" style="opacity:${act.completed ? '0.6' : '1'}">
                    <input type="checkbox" ${act.completed ? 'checked' : ''} onchange="toggleActivity(${act.id})">
                    <div class="activity-info">
                        <strong style="${act.completed ? 'text-decoration:line-through' : ''}">${act.name}</strong> <br>
                        <small>${act.cals} kcal</small>
                    </div>
                    ${act.link ? `<a href="${act.link}" target="_blank" class="activity-link">Ä°zle â–¶</a>` : ''}
                    <button class="delete-btn" onclick="deleteActivity(${act.id})">Sil</button>
                </div>`;
        });
        calculateTotal();
    }

    function toggleActivity(id) {
        const act = activities.find(a => a.id === id);
        if (act) { act.completed = !act.completed; saveData(); renderActivities(); }
    }

    function deleteActivity(id) {
        if(confirm('Silmek istiyor musun?')) {
            activities = activities.filter(a => a.id !== id);
            saveData(); renderActivities();
        }
    }

    function calculateTotal() {
        const weight = parseFloat(document.getElementById('userWeight').value) || 0;
        const steps = parseInt(document.getElementById('dailySteps').value) || 0;
        const stepCals = Math.round(steps * 0.0005 * weight);
        
        let sportCals = 0;
        activities.forEach(act => { if (act.completed) sportCals += act.cals; });

        document.getElementById('stepCalories').innerText = stepCals;
        document.getElementById('sportCalories').innerText = sportCals;
        document.getElementById('totalCalories').innerText = stepCals + sportCals;
        
        // AdÄ±m sayÄ±sÄ±nÄ± anlÄ±k kaydet (sayfa yenilenirse gitmesin diye)
        localStorage.setItem('temp_steps', steps); 
    }

    function saveData() {
        localStorage.setItem('my_activities_v2', JSON.stringify(activities));
        localStorage.setItem('my_history_v2', JSON.stringify(historyLog));
        localStorage.setItem('my_weight', document.getElementById('userWeight').value);
    }

    function loadData() {
        if(localStorage.getItem('my_activities_v2')) activities = JSON.parse(localStorage.getItem('my_activities_v2'));
        if(localStorage.getItem('my_history_v2')) historyLog = JSON.parse(localStorage.getItem('my_history_v2'));
        if(localStorage.getItem('my_weight')) document.getElementById('userWeight').value = localStorage.getItem('my_weight');
        
        // GeÃ§ici adÄ±m sayÄ±sÄ±nÄ± sadece tarih aynÄ±ysa geri yÃ¼kle, yoksa 0 kalacak
        if(localStorage.getItem('last_active_date') === currentDate) {
            document.getElementById('dailySteps').value = localStorage.getItem('temp_steps') || '';
        }
    }
    
    function clearHistory() {
        if(confirm("TÃ¼m geÃ§miÅŸ kayÄ±tlarÄ± silmek istediÄŸine emin misin?")) {
            historyLog = [];
            saveData();
            renderHistory();
        }
    }
</script>

</body>
</html>
