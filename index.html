<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FitTakip Ultimate</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        /* --- TASARIM Sƒ∞STEMƒ∞ --- */
        :root {
            --primary-grad: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg: #f0f2f5;
            --surface: #ffffff;
            --text-main: #2d3436;
            --text-sub: #636e72;
            --border: #dfe6e9;
            --shadow: 0 10px 20px rgba(0,0,0,0.05);
            --radius: 20px;
            --nav-height: 70px;
        }

        /* Dark Mode Desteƒüi */
        [data-theme="dark"] {
            --primary-grad: linear-gradient(135deg, #3a4b8a 0%, #462c63 100%);
            --bg: #121212;
            --surface: #1e1e1e;
            --text-main: #f5f6fa;
            --text-sub: #b2bec3;
            --border: #2d3436;
            --shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0; padding: 0;
            padding-bottom: calc(var(--nav-height) + 20px);
            transition: background 0.3s, color 0.3s;
        }

        /* --- Bƒ∞LE≈ûENLER --- */
        .btn-grad {
            background-image: var(--primary-grad);
            border: none; border-radius: 12px; color: white;
            padding: 15px; width: 100%; font-size: 16px; font-weight: 600;
            box-shadow: 0 4px 15px rgba(118, 75, 162, 0.4);
            cursor: pointer; transition: transform 0.2s;
        }
        .btn-grad:active { transform: scale(0.98); }
        
        .btn-outline {
            background: transparent; border: 2px solid #764ba2;
            color: #764ba2; border-radius: 12px; padding: 14px; width: 100%;
            font-weight: 600; cursor: pointer;
        }

        /* --- KAYIT G√ñSTERGESƒ∞ --- */
        #sync-status {
            position: fixed; top: 15px; left: 50%; transform: translateX(-50%);
            background: #00b894; color: white; padding: 6px 15px;
            border-radius: 20px; font-size: 12px; font-weight: bold;
            z-index: 2000; opacity: 0; transition: opacity 0.3s; pointer-events: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* --- LOGIN EKRANI --- */
        #loginPage {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 30px;
        }
        .login-hero {
            background: var(--surface); padding: 40px 30px; border-radius: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); width: 100%; max-width: 400px;
            text-align: center; position: relative; overflow: hidden;
        }
        .login-hero::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px;
            background: var(--primary-grad);
        }
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group input {
            width: 100%; padding: 15px; border-radius: 12px;
            border: 1px solid var(--border); background: var(--bg);
            color: var(--text-main); font-family: inherit; outline: none;
        }

        /* --- UYGULAMA ƒ∞√áƒ∞ --- */
        header {
            padding: 20px; display: flex; align-items: center; justify-content: space-between;
            background: transparent; max-width: 600px; margin: 0 auto;
        }

        .page { display: none; padding: 0 20px; max-width: 600px; margin: 0 auto; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--surface); border-radius: var(--radius);
            padding: 25px; margin-bottom: 20px;
            box-shadow: var(--shadow); border: 1px solid var(--border);
            position: relative; overflow: hidden;
        }
        
        /* ƒ∞STATƒ∞STƒ∞K KUTULARI */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; text-align: center; }
        .stat-box strong { font-size: 22px; display: block; color: #764ba2; }
        .stat-box small { color: var(--text-sub); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }

        /* Kƒ∞LO BARI */
        .progress-container { background: var(--bg); height: 12px; border-radius: 6px; overflow: hidden; margin-top: 15px; }
        .progress-bar { height: 100%; background: var(--primary-grad); width: 0%; transition: width 0.5s ease; }

        /* G√ñREV Lƒ∞STESƒ∞ */
        .task-row {
            display: flex; align-items: center; background: var(--bg);
            padding: 15px; border-radius: 12px; margin-bottom: 10px;
            transition: 0.2s; cursor: pointer;
        }
        .task-row:active { transform: scale(0.98); }
        .checkbox {
            width: 24px; height: 24px; border: 2px solid #764ba2; border-radius: 6px;
            margin-right: 15px; display: flex; align-items: center; justify-content: center;
        }
        .checked .checkbox { background: #764ba2; }
        .checked .checkbox::after { content: '‚úî'; color: white; font-size: 14px; }
        .checked span { text-decoration: line-through; opacity: 0.5; }

        /* ALT MEN√ú */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height);
            background: var(--surface);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 500; border-top-left-radius: 25px; border-top-right-radius: 25px;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--text-sub); font-size: 10px; gap: 4px; text-decoration: none;
            width: 25%; height: 100%;
        }
        .nav-item i { font-size: 24px; font-style: normal; }
        .nav-item.active { color: #764ba2; font-weight: 700; }
        
        .setting-row { margin-bottom: 15px; }
        .setting-row label { display: block; font-size: 13px; color: var(--text-sub); margin-bottom: 5px; }
        .setting-row input, .setting-row select {
            width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border);
            background: var(--bg); color: var(--text-main); font-family: 'Poppins';
        }
    </style>
</head>
<body>

    <div id="sync-status">‚òÅÔ∏è Kaydedildi</div>

    <div id="loginPage">
        <div class="login-hero">
            <span style="font-size:50px; display:block; margin-bottom:10px;">üî•</span>
            <h1 style="margin:10px 0; font-size:28px;">FitTakip Ultimate</h1>
            <p style="color:var(--text-sub); font-size:14px; margin-bottom:30px;">T√ºm √∂zellikler + Cloud Kayƒ±t</p>

            <div id="auth-forms">
                <div class="input-group"><input type="email" id="email" placeholder="E-posta"></div>
                <div class="input-group"><input type="password" id="password" placeholder="≈ûifre"></div>
                <div id="loginError" style="color:red; font-size:12px; display:none; margin-bottom:10px;"></div>

                <button class="btn-grad" onclick="handleAuth('login')">Giri≈ü Yap</button>
                <button class="btn-outline" style="margin-top:10px;" onclick="handleAuth('register')">Kayƒ±t Ol</button>
            </div>
        </div>
    </div>

    <div id="appPage" style="display:none;">
        
        <header>
            <div>
                <span style="font-size:12px; color:var(--text-sub);">Ho≈ü geldin,</span>
                <h2 id="userDisplay" style="margin:0; font-size:20px;">Kullanƒ±cƒ±</h2>
            </div>
            <button onclick="toggleTheme()" style="background:none; border:none; font-size:24px; cursor:pointer;">üåì</button>
        </header>

        <div id="dashboard" class="page active">
            
            <div class="card">
                <h2>G√ºnl√ºk √ñzet üî•</h2>
                <div class="stat-grid">
                    <div class="stat-box"><strong id="totalCal">0</strong><small>TOPLAM</small></div>
                    <div class="stat-box"><strong id="stepCal">0</strong><small>ADIM</small></div>
                    <div class="stat-box"><strong id="sportCal">0</strong><small>SPOR</small></div>
                </div>
            </div>

            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2 style="margin:0;">V√ºcut Durumu</h2>
                    <span id="bmiLabel" style="font-size:12px; padding:4px 10px; background:#dfe6e9; border-radius:10px; color:#636e72;">BMI: --</span>
                </div>
                <div style="margin-top:15px; display:flex; justify-content:space-between; font-size:14px;">
                    <span>Kilo: <b id="dispWeight">--</b></span>
                    <span>Hedef: <b id="dispTarget">--</b></span>
                </div>
                <div class="progress-container"><div id="weightBar" class="progress-bar"></div></div>
            </div>

            <div class="card">
                <h2>Hƒ±zlƒ± Adƒ±m Giri≈üi üëü</h2>
                <div class="input-group">
                    <input type="number" id="inpSteps" placeholder="Bug√ºn ka√ß adƒ±m?" oninput="handleStepInput(this.value)">
                </div>
                <small style="color:var(--text-sub);">Yazdƒ±ƒüƒ±n an buluta i≈ülenir.</small>
            </div>

            <div class="card">
                <h2>Bug√ºnk√º G√∂revler</h2>
                <div id="taskListDisplay"></div>
                <div style="text-align:center; margin-top:10px; font-size:12px; color:var(--text-sub);">
                    Yeni eklemek i√ßin ‚ö° sekmesine git.
                </div>
            </div>
        </div>

        <div id="add-activity" class="page">
            <div class="card">
                <h2>Yeni Aktivite Tanƒ±mla ‚ö°</h2>
                <div class="setting-row">
                    <label>Aktivite Adƒ±</label>
                    <input type="text" id="newActName" placeholder="√ñrn: Y√ºr√ºy√º≈ü, Mekik...">
                </div>
                <div class="setting-row">
                    <label>Kalori (kcal)</label>
                    <input type="number" id="newActCal" placeholder="0">
                </div>
                <div class="setting-row">
                    <label>Video Linki (Opsiyonel)</label>
                    <input type="url" id="newActLink" placeholder="https://youtube.com...">
                </div>
                <button class="btn-grad" onclick="addNewActivityDef()">Listeye Ekle</button>
            </div>

            <div class="card">
                <h2>Kayƒ±tlƒ± Aktivitelerim</h2>
                <div id="manageListDisplay"></div>
            </div>
        </div>

        <div id="history" class="page">
            <div class="card">
                <h2>Ge√ßmi≈ü Kayƒ±tlar üìú</h2>
                <table width="100%" style="text-align:left; border-collapse:collapse; margin-top:10px;">
                    <thead><tr style="color:var(--text-sub); font-size:12px; border-bottom:1px solid var(--border);"><th style="padding:10px;">Tarih</th><th>Adƒ±m</th><th>Kcal</th></tr></thead>
                    <tbody id="historyTableBody" style="font-size:14px;"></tbody>
                </table>
            </div>
        </div>

        <div id="profile" class="page">
            <div class="card">
                <h2>Profil Ayarlarƒ± ‚öôÔ∏è</h2>
                <div class="setting-row">
                    <label>Boy (cm)</label>
                    <input type="number" id="uHeight" oninput="handleProfileInput()">
                </div>
                <div class="setting-row">
                    <label>G√ºncel Kilo (kg)</label>
                    <input type="number" id="uWeight" oninput="handleProfileInput()">
                </div>
                <div class="setting-row">
                    <label>Hedef Kilo (kg)</label>
                    <input type="number" id="uTarget" oninput="handleProfileInput()">
                </div>
            </div>

            <div class="card" style="border:1px solid #ff7675;">
                <h2 style="color:#ff7675;">Oturum</h2>
                <p style="font-size:12px; color:var(--text-sub);">G√ºn√º bitirince veriler ar≈üive ta≈üƒ±nƒ±r ve saya√ßlar sƒ±fƒ±rlanƒ±r.</p>
                <button class="btn-outline" style="border-color:#ff7675; color:#ff7675;" onclick="endDay()">G√ºn√º Bitir</button>
                <div style="height:10px;"></div>
                <button class="btn-outline" style="border-color:#636e72; color:#636e72;" onclick="auth.signOut(); location.reload();">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </div>

        <nav class="bottom-nav">
            <a href="#" class="nav-item active" onclick="switchPage('dashboard', this)"><i>üè†</i> Ana Sayfa</a>
            <a href="#" class="nav-item" onclick="switchPage('add-activity', this)"><i>‚ö°</i> Ekle</a>
            <a href="#" class="nav-item" onclick="switchPage('history', this)"><i>üìÖ</i> Ge√ßmi≈ü</a>
            <a href="#" class="nav-item" onclick="switchPage('profile', this)"><i>üë§</i> Profil</a>
        </nav>
    </div>

<script>
    // --- 1. FIREBASE BA≈ûLATMA ---
    const firebaseConfig = {
      apiKey: "AIzaSyB656zs8jf-Pib4nDGjzm81EDYsK8WL-Xc",
      authDomain: "fittakipp.firebaseapp.com",
      projectId: "fittakipp",
      storageBucket: "fittakipp.firebasestorage.app",
      messagingSenderId: "526085600537",
      appId: "1:526085600537:web:d56687929540fd932f4188"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- 2. VERƒ∞ YAPISI ---
    const defaultData = {
        dailySteps: 0,
        height: 0,
        weight: 0,
        targetWeight: 0,
        activities: [],     // {id, name, cal, link, completed}
        history: [],        // {date, steps, total}
        lastDate: new Date().toLocaleDateString('tr-TR'),
        theme: 'light'
    };
    
    let appData = JSON.parse(JSON.stringify(defaultData));
    let saveTimeout = null; // Debounce (Gecikmeli kayƒ±t) i√ßin

    // --- 3. AUTH ƒ∞≈ûLEMLERƒ∞ ---
    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appPage').style.display = 'block';
            document.getElementById('userDisplay').innerText = user.email.split('@')[0];
            loadFromCloud(user.uid);
        } else {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('appPage').style.display = 'none';
        }
    });

    function handleAuth(mode) {
        const e = document.getElementById('email').value;
        const p = document.getElementById('password').value;
        const errDiv = document.getElementById('loginError');
        
        const action = (mode === 'login') ? 
            auth.signInWithEmailAndPassword(e, p) : 
            auth.createUserWithEmailAndPassword(e, p);

        action.catch(err => {
            errDiv.style.display = 'block';
            errDiv.innerText = err.message;
        });
    }

    // --- 4. CLOUD ƒ∞≈ûLEMLERƒ∞ (EN √ñNEMLƒ∞ KISIM) ---
    
    // Veriyi √áek
    function loadFromCloud(uid) {
        db.collection('users').doc(uid).get().then(doc => {
            if(doc.exists) {
                appData = { ...defaultData, ...doc.data() }; // Eksikleri tamamla
                checkNewDay(); // Yeni g√ºn kontrol√º
                applyDataToUI(); // Ekrana bas
            } else {
                saveToCloud(true); // ƒ∞lk olu≈üturma
            }
        });
    }

    // Veriyi Kaydet (Gecikmeli / Debounce)
    // Her tu≈üa basƒ±≈üta deƒüil, yazmayƒ± bƒ±rakƒ±nca kaydeder.
    function triggerSave() {
        const status = document.getElementById('sync-status');
        status.style.opacity = '1';
        status.style.background = '#fdcb6e'; // Sarƒ± (Bekliyor)
        status.innerText = "‚òÅÔ∏è Yazƒ±lƒ±yor...";
        
        if(saveTimeout) clearTimeout(saveTimeout);
        
        saveTimeout = setTimeout(() => {
            saveToCloud().then(() => {
                status.style.background = '#00b894'; // Ye≈üil (Ba≈üarƒ±lƒ±)
                status.innerText = "‚úÖ Kaydedildi";
                setTimeout(() => status.style.opacity = '0', 2000);
            });
        }, 1000); // 1 Saniye bekleme s√ºresi
    }

    function saveToCloud(force = false) {
        const user = auth.currentUser;
        if(!user) return Promise.resolve();
        return db.collection('users').doc(user.uid).set(appData).catch(console.error);
    }

    // --- 5. LOGIC & UI ---

    function applyDataToUI() {
        // Inputlarƒ± doldur
        document.getElementById('inpSteps').value = appData.dailySteps || '';
        document.getElementById('uHeight').value = appData.height || '';
        document.getElementById('uWeight').value = appData.weight || '';
        document.getElementById('uTarget').value = appData.targetWeight || '';
        
        // Temayƒ± uygula
        document.documentElement.setAttribute('data-theme', appData.theme);
        
        // Hesaplamalarƒ± yap ve listeleri √ßiz
        calculateStats();
        renderTasks();
        renderHistory();
        renderManageList();
    }

    function calculateStats() {
        // 1. Kalori Hesabƒ±
        const sCal = Math.round((appData.dailySteps || 0) * 0.04);
        let sportCal = 0;
        if(appData.activities) {
            appData.activities.forEach(a => { if(a.completed) sportCal += a.cal; });
        }
        document.getElementById('stepCal').innerText = sCal;
        document.getElementById('sportCal').innerText = sportCal;
        document.getElementById('totalCal').innerText = sCal + sportCal;

        // 2. BMI ve Kilo Barƒ± Hesabƒ±
        const h = appData.height / 100;
        const w = appData.weight;
        const t = appData.targetWeight;
        
        document.getElementById('dispWeight').innerText = w || '--';
        document.getElementById('dispTarget').innerText = t || '--';

        const bmiLabel = document.getElementById('bmiLabel');
        if(h > 0 && w > 0) {
            const bmi = (w / (h*h)).toFixed(1);
            bmiLabel.innerText = "BMI: " + bmi;
            // Renklendirme
            if(bmi < 18.5) bmiLabel.style.background = "#74b9ff"; // Zayƒ±f
            else if(bmi < 25) bmiLabel.style.background = "#00b894"; // Normal
            else if(bmi < 30) bmiLabel.style.background = "#fdcb6e"; // Kilolu
            else bmiLabel.style.background = "#ff7675"; // Obez
        } else {
            bmiLabel.innerText = "BMI: --";
            bmiLabel.style.background = "#dfe6e9";
        }

        // Bar (Basit mantƒ±k: Target'a ne kadar yakƒ±n?)
        if(w > 0 && t > 0) {
            // Kilo verme senaryosu varsayƒ±yoruz
            let pct = 0;
            if (w <= t) pct = 100;
            else {
                // Basit bir g√∂rselle≈ütirme i√ßin
                // Bar doluluƒüu = Hedef / Kilo (Kabaca)
                pct = (t / w) * 100;
            }
            document.getElementById('weightBar').style.width = pct + "%";
        }
    }

    // --- 6. INPUT HANDLERS ---
    
    function handleStepInput(val) {
        appData.dailySteps = parseInt(val) || 0;
        calculateStats(); // Anlƒ±k g√∂r√ºnt√º deƒüi≈üsin
        triggerSave();    // Arkada kaydetsin
    }

    function handleProfileInput() {
        appData.height = parseFloat(document.getElementById('uHeight').value) || 0;
        appData.weight = parseFloat(document.getElementById('uWeight').value) || 0;
        appData.targetWeight = parseFloat(document.getElementById('uTarget').value) || 0;
        calculateStats();
        triggerSave();
    }

    // --- 7. AKTƒ∞Vƒ∞TE Y√ñNETƒ∞Mƒ∞ ---

    function addNewActivityDef() {
        const n = document.getElementById('newActName').value;
        const c = parseInt(document.getElementById('newActCal').value);
        const l = document.getElementById('newActLink').value;
        
        if(n && c) {
            appData.activities.push({
                id: Date.now(),
                name: n,
                cal: c,
                link: l,
                completed: false
            });
            // Temizle
            document.getElementById('newActName').value = '';
            document.getElementById('newActCal').value = '';
            document.getElementById('newActLink').value = '';
            
            renderTasks();
            renderManageList();
            triggerSave();
            alert("Aktivite eklendi!");
        }
    }

    function toggleTask(id) {
        const act = appData.activities.find(a => a.id === id);
        if(act) {
            act.completed = !act.completed;
            calculateStats();
            renderTasks(); // Checkbox'ƒ± g√ºncelle
            triggerSave();
        }
    }

    function deleteTask(id) {
        if(confirm("Bu aktiviteyi listeden silmek istiyor musun?")) {
            appData.activities = appData.activities.filter(a => a.id !== id);
            renderTasks();
            renderManageList();
            calculateStats();
            triggerSave();
        }
    }

    function renderTasks() {
        const list = document.getElementById('taskListDisplay');
        list.innerHTML = '';
        if(!appData.activities) return;
        
        appData.activities.forEach(a => {
            list.innerHTML += `
            <div class="task-row ${a.completed ? 'checked' : ''}" onclick="toggleTask(${a.id})">
                <div class="checkbox"></div>
                <div style="flex:1;">
                    <span style="font-weight:600;">${a.name}</span>
                    <small style="color:var(--text-sub); display:block;">${a.cal} kcal</small>
                </div>
                ${a.link ? `<a href="${a.link}" target="_blank" onclick="event.stopPropagation()" style="font-size:20px; text-decoration:none;">üì∫</a>` : ''}
            </div>`;
        });
    }

    function renderManageList() {
        const list = document.getElementById('manageListDisplay');
        list.innerHTML = '';
        if(!appData.activities) return;

        appData.activities.forEach(a => {
            list.innerHTML += `
            <div class="task-row" style="padding:10px;">
                <span>${a.name} (${a.cal} kcal)</span>
                <button onclick="deleteTask(${a.id})" style="margin-left:auto; color:#ff7675; background:none; border:none; cursor:pointer;">Sil</button>
            </div>`;
        });
    }

    // --- 8. G√úN SONU / GE√áMƒ∞≈û ---
    
    function checkNewDay() {
        const today = new Date().toLocaleDateString('tr-TR');
        if(appData.lastDate !== today) {
            endDay(true); // Otomatik ar≈üivle
            alert("‚òÄÔ∏è Yeni g√ºn ba≈üladƒ±! ƒ∞statistikler sƒ±fƒ±rlandƒ±.");
        }
    }

    function endDay(auto = false) {
        if(!auto && !confirm("G√ºn√º bitirip istatistikleri ar≈üive atmak istiyor musun?")) return;

        const sCal = Math.round((appData.dailySteps || 0) * 0.04);
        let sportCal = 0;
        appData.activities.forEach(a => { if(a.completed) sportCal += a.cal; });
        const total = sCal + sportCal;

        if(total > 0) {
            if(!appData.history) appData.history = [];
            appData.history.unshift({
                date: appData.lastDate,
                steps: appData.dailySteps,
                total: total
            });
        }

        // Sƒ±fƒ±rla
        appData.dailySteps = 0;
        appData.activities.forEach(a => a.completed = false);
        appData.lastDate = new Date().toLocaleDateString('tr-TR');

        // UI G√ºncelle & Kaydet
        applyDataToUI();
        saveToCloud();
    }

    function renderHistory() {
        const tbody = document.getElementById('historyTableBody');
        tbody.innerHTML = '';
        if(!appData.history) return;
        
        appData.history.forEach(h => {
            tbody.innerHTML += `
            <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:10px;">${h.date}</td>
                <td>${h.steps}</td>
                <td><strong>${h.total}</strong></td>
            </tr>`;
        });
    }

    // --- 9. NAVƒ∞GASYON ---
    function switchPage(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        if(btn) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            btn.classList.add('active');
        }
    }

    function toggleTheme() {
        appData.theme = (appData.theme === 'light') ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', appData.theme);
        triggerSave();
    }
</script>
</body>
</html>
