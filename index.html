<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FitTakip Pro - Online</title>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        /* --- CSS DEƒûƒ∞≈ûKENLERƒ∞ --- */
        :root { --primary: #007bff; --bg: #f4f7f6; --text: #333; --card-bg: #ffffff; --input-bg: #ffffff; --border: #ddd; }
        [data-theme="dark"] { --primary: #37a0f4; --bg: #121212; --text: #e0e0e0; --card-bg: #1e1e1e; --input-bg: #2d2d2d; --border: #444; }

        body { font-family: -apple-system, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; transition: 0.3s; }

        /* Gƒ∞Rƒ∞≈û EKRANI TASARIMI */
        #loginPage {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; padding: 20px; text-align: center;
        }
        .login-card {
            background: var(--card-bg); padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%; max-width: 350px;
        }
        .login-card h2 { margin-top: 0; color: var(--primary); }
        .login-card input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--border); border-radius: 8px; background: var(--input-bg); color: var(--text); box-sizing: border-box; }
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        
        /* UYGULAMA Gƒ∞ZLEME (Giri≈ü yapƒ±lana kadar) */
        #appPage { display: none; }

        /* --- MEVCUT TASARIM --- */
        header { background: var(--card-bg); padding: 15px; display: flex; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .menu-btn { font-size: 24px; cursor: pointer; margin-right: 15px; background: none; border: none; color: var(--primary); }
        .sidebar { height: 100%; width: 260px; position: fixed; z-index: 200; top: 0; left: -270px; background-color: #343a40; transition: 0.3s; padding-top: 60px; }
        .sidebar a { padding: 15px 25px; text-decoration: none; color: #f1f1f1; display: block; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .closebtn { position: absolute; top: 10px; right: 20px; font-size: 30px; color: white; background: none; border: none; cursor: pointer; }
        .overlay { display: none; position: fixed; width: 100%; height: 100%; top: 0; left: 0; background: rgba(0,0,0,0.5); z-index: 150; }
        
        .page { display: none; padding: 20px; max-width: 600px; margin: 0 auto; }
        .page.active { display: block; }
        .card { background: var(--card-bg); border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); border-radius: 8px; box-sizing: border-box; }
        button.primary-btn { width: 100%; background-color: var(--primary); color: white; padding: 14px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        
        .bmi-box { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.03); padding: 15px; border-radius: 8px; border: 1px solid var(--border); }
        .task-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid var(--border); }
        .progress-bar { height: 10px; background: var(--border); border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .progress-fill { height: 100%; background: #28a745; width: 0%; transition: width 0.5s; }
        .error-msg { color: #dc3545; font-size: 14px; margin-top: 5px; display: none; }
    </style>
</head>
<body>

    <div id="loginPage">
        <div class="login-card">
            <h1>FitTakip ‚òÅÔ∏è</h1>
            <p>Verilerin artƒ±k bulutta saklanƒ±yor.</p>
            
            <input type="email" id="email" placeholder="E-posta Adresi">
            <input type="password" id="password" placeholder="≈ûifre (En az 6 haneli)">
            <p id="loginError" class="error-msg"></p>

            <div class="btn-group">
                <button class="primary-btn" onclick="girisYap()">Giri≈ü Yap</button>
                <button class="primary-btn" onclick="kayitOl()" style="background-color: #6c757d;">Kayƒ±t Ol</button>
            </div>
            <div style="margin-top:20px; font-size:12px; opacity:0.6;">FitTakip Pro v5.0</div>
        </div>
    </div>

    <div id="appPage">
        <div id="overlay" class="overlay" onclick="closeNav()"></div>

        <div id="mySidebar" class="sidebar">
            <button class="closebtn" onclick="closeNav()">&times;</button>
            <div style="text-align:center; padding: 20px; opacity:0.6; font-size: 12px;">KULLANICI</div>
            <div style="text-align:center; padding-bottom: 20px; font-weight:bold; color:var(--primary);" id="userEmailDisplay">...</div>

            <a href="#" onclick="switchPage('dashboard')">üè† Ana Sayfa</a>
            <a href="#" onclick="switchPage('add-activity')">‚ûï Aktivite Ekle</a>
            <a href="#" onclick="switchPage('history')">üìú Ge√ßmi≈ü</a>
            <a href="#" onclick="switchPage('profile')">üë§ Profil & Ayarlar</a>
            <a href="#" onclick="cikisYap()" style="color:#dc3545; border-top:1px solid #555; margin-top:20px;">üö™ √áƒ±kƒ±≈ü Yap</a>
        </div>

        <header>
            <button class="menu-btn" onclick="openNav()">&#9776;</button>
            <p class="app-title">FitTakip Online</p>
        </header>

        <div id="dashboard" class="page active">
            <div id="weightReminder" class="card" style="background:#fff3cd; color:#856404; display:none; text-align:center; cursor:pointer;" onclick="switchPage('profile')">‚ö†Ô∏è Tartƒ±lma zamanƒ±!</div>
            
            <div class="card">
                <h2>V√ºcut Durumu</h2>
                <div class="bmi-box">
                    <div><small>BMI</small><br><strong id="bmiValue" style="font-size:24px; color:var(--primary);">--</strong></div>
                    <div id="bmiLabel" style="padding:4px 8px; border-radius:4px; font-size:12px; color:white; background:#ccc;">--</div>
                </div>
                <div style="margin-top:10px;">
                    <small>Mevcut: <b id="curW">--</b> | Hedef: <b id="tarW">--</b></small>
                    <div class="progress-bar"><div id="wProg" class="progress-fill"></div></div>
                </div>
            </div>

            <div class="card" style="text-align:center;">
                <div style="display:flex; justify-content:space-around;">
                    <div><strong id="totalCal" style="font-size:20px; color:var(--primary);">0</strong><br><small>Toplam</small></div>
                    <div><strong id="stepCal" style="font-size:20px; opacity:0.6;">0</strong><br><small>Adƒ±m</small></div>
                    <div><strong id="sportCal" style="font-size:20px; opacity:0.6;">0</strong><br><small>Spor</small></div>
                </div>
            </div>

            <div class="card">
                <h2>Bug√ºnk√º Antrenmanlar</h2>
                <div id="taskList"></div>
            </div>

            <div class="card">
                <h2>Adƒ±m Sayacƒ±</h2>
                <input type="number" id="dailySteps" placeholder="Adƒ±m sayƒ±sƒ±..." oninput="calculate()">
            </div>
        </div>

        <div id="add-activity" class="page">
            <div class="card">
                <h2>Aktivite Ekle</h2>
                <input type="text" id="actName" placeholder="Ad (√ñrn: Y√ºr√ºy√º≈ü)">
                <input type="url" id="actLink" placeholder="YouTube Linki (Opsiyonel)">
                <input type="number" id="actCal" placeholder="Kalori">
                <button class="primary-btn" onclick="addNewActivity()">Listeme Ekle</button>
            </div>
            <div class="card">
                <h2>Listem</h2>
                <div id="manageList"></div>
            </div>
        </div>

        <div id="history" class="page">
            <div class="card">
                <h2>Ge√ßmi≈ü</h2>
                <table width="100%" id="historyTable" style="text-align:left;"><thead><th>Tarih</th><th>Adƒ±m</th><th>Kcal</th></thead><tbody></tbody></table>
                <button class="primary-btn" style="background:#6c757d; margin-top:20px;" onclick="clearHistory()">Ge√ßmi≈üi Sil</button>
            </div>
        </div>

        <div id="profile" class="page">
            <div class="card">
                <h2>Ayarlar</h2>
                <label>Boy (cm)</label><input type="number" id="uHeight" onchange="calculate()">
                <label>Kilo (kg)</label><input type="number" id="uWeight" onchange="updateWeightDate()">
                <label>Hedef Kilo</label><input type="number" id="uTarget" onchange="saveToCloud()">
                <label>Hatƒ±rlatma Sƒ±klƒ±ƒüƒ±</label>
                <select id="uFreq" onchange="saveToCloud()"><option value="7">Haftada 1</option><option value="30">Ayda 1</option></select>
                <div style="margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                    <span>Koyu Mod</span><button onclick="toggleTheme()" id="themeBtn" style="padding:5px 10px;">‚òÄ</button>
                </div>
                <button class="primary-btn" onclick="saveToCloud(); alert('Kaydedildi!');">Kaydet</button>
            </div>
            <div class="card">
                <h2>G√ºn√º Bitir</h2>
                <button class="primary-btn" style="background:#ff9800;" onclick="endDay()">G√ºn√º Ar≈üivle</button>
            </div>
        </div>
    </div>

<script>
    // --- BURASI √áOK √ñNEMLƒ∞: KENDƒ∞ KODUNU BURAYA YAPI≈ûTIR ---
    // Firebase sayfasƒ±ndaki "const firebaseConfig = { ... }" kƒ±smƒ±nƒ±
    // a≈üaƒüƒ±daki s√ºsl√º parantezlerin arasƒ±na birebir yapƒ±≈ütƒ±r.
    
const firebaseConfig = {
      apiKey: "AIzaSyB656zs8jf-Pib4nDGjzm81EDYsK8WL-Xc",
      authDomain: "fittakipp.firebaseapp.com",
      projectId: "fittakipp",
      storageBucket: "fittakipp.firebasestorage.app",
      messagingSenderId: "526085600537",
      appId: "1:526085600537:web:d56687929540fd932f4188",
      measurementId: "G-81YYJKDC4R"
    };

    // --------------------------------------------------------

    // Firebase'i Ba≈ülat
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Veri Yapƒ±sƒ±
    let appData = {
        activities: [], history: [],
        weight: 0, height: 0, targetWeight: 0, weightFreq: 7, lastWeightUpdate: null,
        dailySteps: 0, lastDate: new Date().toLocaleDateString('tr-TR'), theme: 'light'
    };

    // --- OTURUM Y√ñNETƒ∞Mƒ∞ ---
    auth.onAuthStateChanged(user => {
        if (user) {
            // Giri≈ü Yapƒ±ldƒ±
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appPage').style.display = 'block';
            document.getElementById('userEmailDisplay').innerText = user.email;
            loadFromCloud(user.uid); // Verileri √áek
        } else {
            // √áƒ±kƒ±≈ü Yapƒ±ldƒ±
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('appPage').style.display = 'none';
        }
    });

    function girisYap() {
        const e = document.getElementById('email').value;
        const p = document.getElementById('password').value;
        auth.signInWithEmailAndPassword(e, p).catch(err => showError(err.message));
    }

    function kayitOl() {
        const e = document.getElementById('email').value;
        const p = document.getElementById('password').value;
        auth.createUserWithEmailAndPassword(e, p).then(() => {
            // Yeni kullanƒ±cƒ± i√ßin bo≈ü veritabanƒ± olu≈ütur
            saveToCloud();
        }).catch(err => showError(err.message));
    }

    function cikisYap() { auth.signOut(); }
    function showError(msg) { 
        const el = document.getElementById('loginError'); 
        el.style.display='block'; 
        if(msg.includes('auth/weak-password')) el.innerText = "≈ûifre en az 6 karakter olmalƒ±.";
        else if(msg.includes('auth/invalid-email')) el.innerText = "Ge√ßersiz e-posta adresi.";
        else if(msg.includes('auth/email-already-in-use')) el.innerText = "Bu e-posta zaten kayƒ±tlƒ±.";
        else if(msg.includes('auth/user-not-found') || msg.includes('auth/wrong-password')) el.innerText = "Hatalƒ± e-posta veya ≈üifre.";
        else el.innerText = msg;
    }

    // --- BULUT VERƒ∞TABANI ƒ∞≈ûLEMLERƒ∞ ---
    function saveToCloud() {
        const user = auth.currentUser;
        if(user) {
            db.collection('users').doc(user.uid).set(appData)
            .then(() => console.log("Buluta kaydedildi"))
            .catch(e => console.error("Hata", e));
        }
    }

    function loadFromCloud(uid) {
        db.collection('users').doc(uid).get().then(doc => {
            if (doc.exists) {
                appData = doc.data(); // Veriyi al
                updateUI(); // Ekranƒ± g√ºncelle
                checkNewDay(); // G√ºn kontrol√º yap
            } else {
                saveToCloud(); // ƒ∞lk kez giriyorsa olu≈ütur
            }
        });
    }

    // --- HESAPLAMA & UI (ESKƒ∞ KODLARIMIZIN AYNISI) ---
    function updateWeightDate() { appData.lastWeightUpdate = new Date().toISOString().split('T')[0]; calculate(); }
    
    function calculate() {
        // UI'dan veriyi al
        appData.dailySteps = parseInt(document.getElementById('dailySteps').value) || 0;
        appData.height = parseFloat(document.getElementById('uHeight').value) || 0;
        appData.weight = parseFloat(document.getElementById('uWeight').value) || 0;
        appData.targetWeight = parseFloat(document.getElementById('uTarget').value) || 0;
        appData.weightFreq = parseInt(document.getElementById('uFreq').value) || 7;

        // Kalori
        const sCal = Math.round(appData.dailySteps * 0.04);
        let spCal = 0; appData.activities.forEach(a => { if(a.completed) spCal += a.cal; });
        document.getElementById('totalCal').innerText = sCal + spCal;
        document.getElementById('stepCal').innerText = sCal;
        document.getElementById('sportCal').innerText = spCal;

        // BMI
        if(appData.height > 0 && appData.weight > 0) {
            const h = appData.height/100;
            const bmi = (appData.weight / (h*h)).toFixed(1);
            document.getElementById('bmiValue').innerText = bmi;
            const lbl = document.getElementById('bmiLabel');
            if(bmi<25) { lbl.innerText="Normal"; lbl.style.background="#28a745"; }
            else { lbl.innerText="Fazla"; lbl.style.background="#ffc107"; }
        }
        document.getElementById('curW').innerText = appData.weight;
        document.getElementById('tarW').innerText = appData.targetWeight;
        if(appData.targetWeight > 0) document.getElementById('wProg').style.width = "100%";

        // Hatƒ±rlatma
        if(appData.lastWeightUpdate) {
            const diff = Math.ceil(Math.abs(new Date() - new Date(appData.lastWeightUpdate)) / 86400000);
            document.getElementById('weightReminder').style.display = (diff > appData.weightFreq) ? 'block' : 'none';
        }
        
        saveToCloud(); // Her deƒüi≈üiklikte buluta yaz
        renderTasks();
    }

    // --- Dƒ∞ƒûER FONKSƒ∞YONLAR ---
    function updateUI() {
        document.getElementById('uHeight').value = appData.height;
        document.getElementById('uWeight').value = appData.weight;
        document.getElementById('uTarget').value = appData.targetWeight;
        document.getElementById('uFreq').value = appData.weightFreq;
        document.getElementById('dailySteps').value = appData.dailySteps;
        applyTheme();
        calculate();
        renderHistory();
        renderManage();
    }

    function addNewActivity() {
        const n = document.getElementById('actName').value;
        const c = parseInt(document.getElementById('actCal').value);
        const l = document.getElementById('actLink').value;
        if(n && c) {
            appData.activities.push({id:Date.now(), name:n, cal:c, link:l, completed:false});
            document.getElementById('actName').value=''; document.getElementById('actCal').value='';
            updateUI(); alert("Eklendi!");
        }
    }
    
    function toggleTask(id) {
        const t = appData.activities.find(a=>a.id===id);
        if(t) { t.completed=!t.completed; calculate(); }
    }
    
    function deleteTask(id) {
        if(confirm("Sil?")) { appData.activities=appData.activities.filter(a=>a.id!==id); updateUI(); }
    }

    function renderTasks() {
        const c = document.getElementById('taskList'); c.innerHTML = '';
        appData.activities.forEach(a => {
            c.innerHTML += `<div class="task-item"><input type="checkbox" ${a.completed?'checked':''} onchange="toggleTask(${a.id})" style="width:20px;margin-right:10px;"><div><b>${a.name}</b> (${a.cal} kcal) ${a.link ? `<a href="${a.link}" target="_blank">‚ñ∂</a>`:''}</div></div>`;
        });
    }

    function renderManage() {
        const c = document.getElementById('manageList'); c.innerHTML='';
        appData.activities.forEach(a => c.innerHTML += `<div class="task-item"><span>${a.name}</span> <button onclick="deleteTask(${a.id})" style="margin-left:auto;background:#dc3545;color:white;border:none;border-radius:4px;">Sil</button></div>`);
    }

    function checkNewDay() {
        const t = new Date().toLocaleDateString('tr-TR');
        if(appData.lastDate !== t) { endDay(true); appData.lastDate = t; appData.dailySteps=0; appData.activities.forEach(a=>a.completed=false); saveToCloud(); alert("Yeni g√ºn!"); }
    }

    function endDay(auto=false) {
        if(!auto && !confirm("G√ºn√º bitir?")) return;
        const s = Math.round(appData.dailySteps * 0.04);
        let sp = 0; appData.activities.forEach(a => { if(a.completed) sp += a.cal; });
        if(s+sp > 0) {
            appData.history.unshift({date: appData.lastDate, total: s+sp, steps: appData.dailySteps});
            if(!auto) { appData.dailySteps=0; appData.activities.forEach(a=>a.completed=false); }
            saveToCloud(); updateUI();
        }
    }

    function renderHistory() {
        const t = document.querySelector('#historyTable tbody'); t.innerHTML='';
        appData.history.forEach(h => t.innerHTML += `<tr><td>${h.date}</td><td>${h.steps}</td><td>${h.total} kcal</td></tr>`);
    }
    function clearHistory() { if(confirm("Sil?")) { appData.history=[]; saveToCloud(); updateUI(); } }

    function toggleTheme() {
        appData.theme = appData.theme === 'light' ? 'dark' : 'light';
        applyTheme(); saveToCloud();
    }
    function applyTheme() {
        document.documentElement.setAttribute('data-theme', appData.theme);
        document.getElementById('themeBtn').innerText = appData.theme==='light'?'‚òÄ':'üåô';
    }

    // MEN√ú
    function openNav() { document.getElementById("mySidebar").style.left = "0"; document.getElementById("overlay").style.display="block"; }
    function closeNav() { document.getElementById("mySidebar").style.left = "-270px"; document.getElementById("overlay").style.display="none"; }
    function switchPage(id) { document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); document.getElementById(id).classList.add('active'); closeNav(); }

</script>
</body>
</html>